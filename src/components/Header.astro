---
import LogoMain from "@assets/logo/logo-main-hor.png";
import { Image } from "astro:assets";
---

<header class="header" id="header">
  <nav class="navbar container">
    <a href="/" class="brand"><Image src={LogoMain} alt="logo" width={100}/></a>
    <div class="burger" id="burger">
      <span class="burger-line"></span>
      <span class="burger-line"></span>
      <span class="burger-line"></span>
    </div>
    <div class="menu" id="menu">
      <ul class="menu-inner">
        <li class="menu-item">
          <a href="#" class="menu-link">Проекты домов</a>
        </li>
        <li class="menu-item"><a href="#" class="menu-link">Наши работы</a></li>
        <li class="menu-item"><a href="#" class="menu-link">Технологии</a></li>
        <li class="menu-item"><a href="#" class="menu-link">Контакты</a></li>
      </ul>
    </div>
    <a href="#">
        <i class="fa-solid fa-phone btn-phone"></i>
      </a>
    <button type="button" class="button">
      <a href="#" class="btn btn-brown-dark">Заказать звонок</a>
    </button>
    <span class="overlay"></span>
  </nav>
</header>

<style lang="scss">
  .button {

    @media screen and (max-width: 768px) {
      display: none;
      visibility: hidden;
    }
  }

  .btn {
    display: inline-flex;
    column-gap: 0.35rem;
    justify-content: center;
    align-items: center;
    vertical-align: middle;
    transition: all 0.25s ease;
    border-radius: 0.25rem;
    padding-inline: 1.25rem;
    padding-block: 0.5rem;
    line-height: 1.5;
    text-align: center;
    font-family: $font-main;
    white-space: nowrap;

    &-brown-dark {
      box-shadow: var(--shadow-medium);
      background-color: $color-brown-dark;
      color: var(--color-gray-100);
    }

  }

  .btn-phone {
    color: $color-brown-dark;
    font-size: 1.5rem;
  }

  // Header section
  .header {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 100;
    transition: all 0.5s ease;
    margin: 0 auto;
    width: 100%;
    height: auto;
    box-shadow: $shadow-medium;
  }

  .navbar {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    max-width: 100%;
  }

  .menu {
    position: fixed;
    left: -100%;
    top: 65px;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-medium);
    background-color: white;
    padding-block: 4rem;
    width: 100%;
    height: auto;
    overflow: hidden;
    padding: 10px;

    &.is-active {
      top: 50px;
      left: 0;
      max-width: 50rem;
    }

    &-inner {
      display: flex;
      row-gap: 1.25rem;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
    }

    &-link {
      color: $color-main;
      font-weight: 500;
      text-transform: uppercase;
    }

    &-block {
      // margin-left: auto;
    }

    // Media query breakpoint
    @media screen and (min-width: 48rem) {
      display: none;
      visibility: hidden;
      position: relative;
      top: initial;
      transition: unset;
      // margin-left: auto;
      box-shadow: unset;
      background: unset;
      padding: 0;
      width: auto;

      &-inner {
        display: flex;
        column-gap: 2rem;
        flex-direction: row;
        // margin-inline: auto;
      }

      &-link {
        text-transform: capitalize;
      }
    }
  }

  .burger {
    display: block;
    position: relative;
    order: -1;
    visibility: visible;
    z-index: 10;
    cursor: pointer;
    width: 1.5rem;
    height: 1rem;
    user-select: none;

    // Media query breakpoint
    // @media screen and (min-width: 48rem) {
    //   display: none;
    //   visibility: hidden;
    // }

    &-line {
      display: block;
      position: absolute;
      left: 0;
      opacity: 1;
      transition: all 0.25s ease;
      background-color: $color-main;
      width: 100%;
      height: 2px;

      &:nth-child(1) {
        top: 0px;
      }
      &:nth-child(2) {
        top: 0.5rem;
        width: 70%;
      }
      &:nth-child(3) {
        top: 1rem;
      }
    }

    &.is-active &-line {
      &:nth-child(1) {
        top: 0.5rem;
        transform: rotate(135deg);
      }
      &:nth-child(2) {
        left: -1rem;
        opacity: 0;
      }
      &:nth-child(3) {
        top: 0.5rem;
        transform: rotate(-135deg);
      }
    }
  }

  .overlay {
    display: none;
    position: fixed;
    opacity: 0.5;
    z-index: -2;
    transition: all 0.5s ease-in-out;
    inset: 0;
    background-color: black;
    width: 100%;
    height: 100%;

    &.is-active {
      display: block;
      margin-top: 65px;
    }
  }
</style>

<script>
  const menu = document.getElementById("menu");
  const burger = document.getElementById("burger");
  const header = document.getElementById("header");
  const overlay = document.querySelector(".overlay");

  const toggleMenu = () => {
    const isOpened = menu.classList.toggle("is-active");
    burger.classList.toggle("is-active");
    overlay.classList.toggle("is-active");
    // Блокируем скролл body при открытом меню
    document.body.style.overflow = isOpened ? "hidden" : "";
  };

  // Закрытие при клике на бургер, оверлей или ссылки (делегирование)
  [burger, overlay, menu].forEach((el) => {
    el.addEventListener("click", (e) => {
      // Если клик по меню — закрываем только если это ссылка
      if (el === menu && !e.target.closest("a")) return;
      toggleMenu();
    });
  });

  // Оптимизированный скролл
  // window.addEventListener(
  //   "scroll",
  //   () => {
  //     header.classList.toggle("on-scroll", window.scrollY >= 75);
  //   },
  //   { passive: true },
  // );
</script>
